title: WinRAR Execution Of Cmd.exe (CVE-2023-38331 Campaign)
id: 50f107ad-5792-47df-a651-aa70f552fe7a
status: experimental
description: |
    In the first known campaign related to CVE-2023-38331, the threat actor used cmd to wmic as part of the initial execution chain to load various droppers. 
    This is possible when the archiver (e.g. WinRAR below v6.23) receives the wrong parameter via the ShellExecute function, causing the search criteria to fail for the selected file and subsequently execute a similar secondary file (name) with added object extension.
references:
    - https://www.win-rar.com/singlenewsview.html?&L=0&tx_ttnews%5Btt_news%5D=232&cHash=c5bf79590657e32554c6683296a8e8aa
    - https://www.group-ib.com/blog/cve-2023-38831-winrar-zero-day/
    - https://www.virustotal.com/gui/collection/e8e2c835bd4295846399ac2a123a1458ff67a99d3cf1f94bd2277755490be41f/summary
author: Andreas Braathen (mnemonic.io)
date: 2023/08/30
tags:
    - detection.emerging_threats
    - attack.execution
    - attack.t1203
    - cve.2023.38331
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        ParentImage|endswith:
            - '\winrar.exe'
        Image|endswith:
            - '\cmd.exe'
        CommandLine|contains|all:
            - 'Temp\Rar$'
            - '.cmd'
    condition: selection
falsepositives:
    - Unlikely
    - False negative may occur based on .cmd as file extension (not required), but may reduce precision.
level: high
