title: Unusual .bat Process Invoking GoogleUpdate.exe to Disable-PnpDevice
id: 26bd23d1-4398-4fab-bb52-c5c58385a8ae
status: experimental
description: Detects unusual behavior where a .bat process invokes "GoogleUpdate.exe" with the purpose of disabling PnP devices.
references:
    - https://github.security.telekom.com/2023/08/darkgate-loader.html
author: Sai Prashanth ( @pulisettis)
date: 2023/10/26
modified: 2023/10/26
tags:
    - attack.discovery
    - attack.execution
    - attack.command_and_control
    - detection.emerging_threats
logsource:
    category: process_creation
    product: windows
detection:
  #PowerShell.exe  -Command "Get-PnpDevice -Class 'Mouse' | Disable-PnpDevice -Confirm:$false"
  #C:\Windows\system32\cmd" /c "C:\Users\*\AppData\Local\Temp\539E.tmp\539F.bat "C:\Program Files (x86)\Google\Update\GoogleUpdate.exe""
    selection:
        Image|endswith:
            - 'cmd'
            - '*.bat'
            - 'GoogleUpdate.exe'
        CommandLine|contains|all:
            - 'PowerShell.exe'
            - 'Get-PnpDevice'
            - 'Disable-PnpDevice'
    condition: selection
level: high
