title: Suspicious Process Genealogy - WScript.exe Spawns RunDll32.exe
id: 6ec62ed0-b471-455e-b9c0-c667c92b22f2    
status: experimental
description: | 
    Detects execution of 'RunDll32.exe' (Windows Host process) by 'WScript.exe' (Windows Script engine).    
    'WScript.exe' may be abused by adversaries to achieve initial execution (e.g. malicious JavaScript or Visual Basic Script scripts).
    'RunDll32.exe' may be abused by adversaries to proxy execution of malicious payloads (dll files).  
    In the observed Pikabot infections, a JavaScript script is used to orchestrate the downlaod and execution of malicious DLL files.
references:
    - https://github.com/pr0xylife/Pikabot/blob/main/Pikabot_30.10.2023.txt
    - https://github.com/pr0xylife/Pikabot/blob/main/Pikabot_22.12.2023.txt    
author: Alejandro Houspanossian ('@lekz86')
date: 2023/12/27
tags:
    - attack.defense_evasion
    - attack.t1059.007
    - attack.t1218.011
    - detection.emerging_threats
logsource:
    product: windows
    category: process_creation
detection:
    selection_parent: 
        # wscript.exe C:\Users\Admin\AppData\Local\Temp\Notesjl.js
        # wscript.exe C:\Users\Admin\AppData\Local\Temp\Accusamusb.js
        ParentImage|endswith: '\wscript.exe' 
    selection_child: 
        # rundll32 C:\Gofkvlgdigt\Ekfgihcifmv\Ikfigkvosjr.dll,Enter
        # RUNDLL32 C:\Users\Admin\AppData\Local\Temp\LC.sct, Crash
        Image|endswith: '\rundll32.exe'                
    filter_child:
        Image|endswith: '\rundll32.exe' 
        CommandLine|contains:            
            - 'UpdatePerUserSystemParameters' 
            - 'PrintUIEntry'
            - 'ClearMyTracksByProcess'
    condition: all of selection_* and not filter_child
falsepositives:
    - Unknown
level: high
