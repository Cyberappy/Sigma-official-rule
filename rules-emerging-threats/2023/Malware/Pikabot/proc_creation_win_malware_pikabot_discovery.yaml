title: Potential Pikabot Discovery Activity
id: 84d70ab3-ba9f-420f-9b9c-c148760ac61f
status: experimental
description: Detects the system discovery activity carried out by Pikabot, after injecting it into legitimitate process such as searchfilterhost.exe. 
references:
    - https://tria.ge/231023-lpw85she57/behavioral2
    - https://tria.ge/231211-yqc8wahea6/behavioral2
    - https://tria.ge/231206-w5gthabf23/behavioral2
author: Swachchhanda Shrawan Poudel
date: 2024/01/16
tags:
    - attack.discovery
    - attack.t1016
    - attack.t1049
    - attack.t1087
    - detection.emerging_threats
detection:
    selection_1:
        Image|endswith:
            - '\SearchProtocolHost.exe'
            - '\SearchFilterHost.exe'
        CommandLine:
            - 'ipconfig.exe /all'
            - 'netstat.exe -aon'
            - 'whoami.exe /all'
      selection_2:
        Image|endswith:
            - '\ipconfig.exe'
            - '\netstat.exe'
            - '\whoami.exe'
        ParentImage|endswith:
            - '\SearchProtocolHost.exe'
            - '\SearchFilterHost.exe'
    condition: 1 of selection_*
falsepositives:
    - Unlikely
level: Critical