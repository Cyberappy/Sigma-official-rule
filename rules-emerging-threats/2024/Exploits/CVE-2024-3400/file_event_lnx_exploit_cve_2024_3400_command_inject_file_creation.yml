title: CVE-2024-3400 - Command Injected File Creation
id: bcd95697-e3e7-4c6f-8584-8e3503e6929f
status: experimental
description: |
    Detects suspicious file creations in the Palo Alto Networks PAN-OS' parent telemetry folder, which are processed by the vulnerable 'dt_curl' script if device telemetry is enabled.
    As said script overrides the shell-subprocess restriction, arbitrary command execution may occur by carefully crafting filenames that are escaped through this function.
references:
    - https://labs.watchtowr.com/palo-alto-putting-the-protecc-in-globalprotect-cve-2024-3400/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-3400
author: Andreas Braathen (mnemonic.io)
date: 2024/04/18
tags:
    - attack.execution
    - cve.2024.3400
    - detection.emerging_threats
logsource:
    product: linux
    category: file_event
    definition: 'Requirements: The PAN-OS device telemetry function must be enabled for command injection (part 2) to be exploitable. Otherwise it would only be an arbitrary file creation vulnerability (part 1)'
detection:
    selection:
        TargetFilename|contains:
            - '{IFS}'
            - 'base64'
            - 'bash'
            - 'curl'
            - 'http'
        Image|startswith: '/opt/panlogs/tmp/device_telemetry/'
    condition: selection
falsepositives:
    - The PAN-OS device telemetry function does not enforce a standard filename convention, but observations are unlikely.
level: medium
