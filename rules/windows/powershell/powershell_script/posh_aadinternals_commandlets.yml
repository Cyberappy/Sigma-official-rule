title: AADInternals PowerShell Commandlets
id: 45cc7066-a350-4086-9ff4-5a3071fdfc0d
status: experimental
description: Detects ADDInternals tool is being used for administering or hacking Azure AD and Office 365.
references:
    - https://o365blog.com/aadinternals/
    - https://github.com/Gerenios/AADInternals
author: Austin Songer (@austinsonger)
date: 2021/10/23
logsource:
    product: windows
    category: ps_script
    definition: Script Block Logging must be enable
detection:
    selection:
        ScriptBlockText|contains:
            - "Get-AADIntLoginInformation"
            - "Get-AADIntEndpointInstances"
            - "Get-AADIntEndpointIps"
            - "Get-AADIntTenantDetails"
            - "Get-AADIntTenantID"
            - "Get-AADIntOpenIDConfiguration"
            - "Get-AADIntServiceLocations"
            - "Get-AADIntServicePlans"
            - "Get-AADIntServicePrincipals"
            - "Get-AADIntSubscriptions"
            - "Get-AADIntSPOServiceInformation"
            - "Get-AADIntCompanyInformation"
            - "Get-AADIntCompanyTags"
            - "Get-AADIntAADConnectStatus"
            - "Get-AADIntSyncConfiguration"
            - "Get-AADIntTenantDomains"
            - "Get-AADIntKerberosDomainSyncConfig"
            - "Get-AADIntWindowsCredentialsSyncConfig"
            - "Get-AADIntSyncDeviceConfiguration"
            - "Get-AADIntTenantAuthPolicy"
            - "Get-AADIntTenantGuestAccess"
            - "Set-AADIntTenantGuestAccess"
            - "Enable-AADIntTenantMsolAccess"
            - "Disable-AADIntTenantMsolAccess"
            - "Get-AADIntUnifiedAuditLogSettings"
            - "Set-AADIntUnifiedAuditLogSettings"
            - "Get-AADIntComplianceAPICookies"
            - "Search-AADIntUnifiedAuditLog"
            - "Get-AADIntConditionalAccessPolicies"
            - "Get-AADIntSelfServicePurchaseProducts"
            - "Set-AADIntSelfServicePurchaseProduct"
            - "Get-AADIntRolloutPolicies"
            - "Set-AADIntRolloutPolicy"
            - "Remove-AADIntRolloutPolicy"
            - "Get-AADIntRolloutPolicyGroups"
            - "Add-AADIntRolloutPolicyGroups"
            - "Remove-AADIntRolloutPolicyGroups"
            - "Read-AADIntAccesstoken"
            - "Get-AADIntImmutableID"
            - "Start-AADIntCloudShell"
            - "Get-AADIntUsers"
            - "Get-AADIntUser"
            - "New-AADIntUser"
            - "Set-AADIntUser"
            - "Remove-AADIntUser"
            - "Get-AADIntGlobalAdmins"
            - "Get-AADIntUserMFA"
            - "Set-AADIntUserMFA"
            - "Get-AADIntUserMFAApps"
            - "Set-AADIntUserMFAApps"
            - "Register-AADIntMFAApp"
            - "New-AADIntOTPSecret"
            - "New-AADIntOTP"
            - "Get-AADIntSyncObjects"
            - "Set-AADIntAzureADObject"
            - "Remove-AADIntAzureADObject"
            - "Set-AADIntUserPassword"
            - "Set-AADIntServiceAccount"
            - "Get-AADIntEASAutoDiscover"
            - "Get-AADIntEASAutoDiscoverV1"
            - "Set-AADIntEASSettings"
            - "Get-AADIntMobileDevices"
            - "Send-AADIntEASMessage"
            - "Send-AADIntOutlookMessage"
            - "Open-AADIntOWA"
            - "Get-AADIntSPOSiteUsers"
            - "Get-AADIntSPOUserProperties"
            - "Get-AADIntSPOSiteGroups"
            - "New-AADIntOneDriveSettings"
            - "Get-AADIntOneDriveFiles"
            - "Send-AADIntOneDriveFile"
            - "Get-AADIntSkypeToken"
            - "Set-AADIntTeamsAvailability"
            - "Set-AADIntTeamsStatusMessage"
            - "Search-AADIntTeamsUser"
            - "Send-AADIntTeamsMessage"
            - "Get-AADIntTeamsMessages"
            - "Set-AADIntTeamsMessageEmotion"
            - "Remove-AADIntTeamsMessages"
            - "Set-AADIntDomainAuthentication"
            - "ConvertTo-AADIntBackdoor"
            - "New-AADIntBackdoor"
            - "Open-AADIntOffice365Portal"
            - "Set-AADIntPassThroughAuthentication"
            - "Install-AADIntPTASpy"
            - "Get-AADIntPTASpyLog"
            - "Remove-AADIntPTASpy"
            - "Register-AADIntPTAAgent"
            - "Register-AADIntSyncAgent"
            - "Set-AADIntPTACertificate"
            - "Invoke-AADIntPTAAgent"
            - "Get-AADIntProxyAgents"
            - "Get-AADIntProxyAgentGroups"
            - "Set-AADIntPasswordHashSyncEnabled"
            - "New-AADIntGuestInvitation"
            - "Get-AADIntSyncCredentials"
            - "Update-AADIntSyncCredentials"
            - "Get-AADIntSyncEncryptionKeyInfo"
            - "Get-AADIntSyncEncryptionKey"
            - "New-AADIntADFSSelfSignedCertificates"
            - "Restore-AADIntADFSAutoRollover"
            - "Update-AADIntADFSFederationSettings"
            - "Export-AADIntADFSCertificates"
            - "Export-AADIntADFSConfiguration"
            - "Export-AADIntADFSEncryptionKey"
            - "Set-AADIntADFSConfiguration"
            - "Get-AADIntADFSPolicyStoreRules"
            - "Set-AADIntADFSPolicyStoreRules"
            - "Get-AADIntDesktopSSO"
            - "Set-AADIntDesktopSSOEnabled"
            - "New-AADIntKerberosTicket"
            - "Get-AADIntDPAPIKeys"
            - "Get-AADIntLSASecrets"
            - "Get-AADIntLSABackupKeys"
            - "Get-AADIntSystemMasterKeys"
            - "Get-AADIntUserMasterKeys"
            - "Get-AADIntLocalUserCredentials"
            - "Get-AADIntUserPRTToken"
            - "Join-AADIntOnPremDeviceToAzureAD"
            - "Join-AADIntDeviceToAzureAD"
            - "Get-AADIntUserPRTKeys"
            - "New-AADIntUserPRTToken"
            - "New-AADIntBulkPRTToken"
            - "New-AADIntP2PDeviceCertificate"
            - "Join-AADIntDeviceToIntuneMDM"
            - "Start-AADIntDeviceDMSync"
            - "Get-AADIntDeviceRegAuthMethods"
            - "Set-AADIntDeviceRegAuthMethods"
            - "Get-AADIntDeviceTransportKey"
            - "Set-AADIntDeviceTransportKey"
            - "Get-AADIntDeviceCompliance"
            - "Set-AADIntDeviceCompliant"
            - "Get-AADIntOfficeUpdateBranch"
            - "Set-AADIntOfficeUpdateBranch"
            - "Get-AADIntSARAUserInfo"
            - "Get-AADIntSARATenantInfo"
            - "Grant-AADIntAzureUserAccessAdminRole"
            - "Get-AADIntAzureSubscriptions"
            - "Set-AADIntAzureRoleAssignment"
            - "Get-AADIntAzureClassicAdministrators"
            - "Get-AADIntAzureResourceGroups"
            - "Get-AADIntAzureVMs"
            - "Invoke-AADIntAzureVMScript"
            - "Get-AADIntAzureVMRdpSettings"
            - "Get-AADIntAzureTenants"
            - "Get-AADIntAzureInformation"
            - "Get-AADIntAzureSignInLog"
            - "Get-AADIntAzureAuditLog"
            - "Remove-AADIntAzureDiagnosticSettings"
            - "Get-AADIntAzureDiagnosticSettings"
            - "Get-AADIntAzureDiagnosticSettingsDetails"
            - "Set-AADIntAzureDiagnosticSettingsDetails"
            - "Get-AADIntAzureDirectoryActivityLog"
            - "New-AADIntHybridHealthService"
            - "Get-AADIntHybridHealthServices"
            - "Remove-AADIntHybridHealthService"
            - "New-AADIntHybridHealthServiceMember"
            - "Get-AADIntHybridHealthServiceMembers"
            - "Remove-AADIntHybridHealthServiceMember"
            - "Get-AADIntHybridHealthServiceMonitoringPolicies"
            - "Send-AADIntHybridHealthServiceEvents"
            - "New-AADIntHybridHealtServiceEvent"
            - "Register-AADIntHybridHealthServiceAgent"
            - "Invoke-AADIntReconAsOutsider"
            - "Invoke-AADIntUserEnumerationAsOutsider"
            - "Invoke-AADIntReconAsGuest"
            - "Invoke-AADIntUserEnumerationAsGuest"
            - "Invoke-AADIntReconAsInsider"
            - "Invoke-AADIntUserEnumerationAsInsider"
            - "Invoke-AADIntPhishing"
            - "Get-AADIntAdUserNTHash"
            - "Get-AADIntADUserThumbnailPhoto"
            - "Get-AADIntDesktopSSOAccountPassword"
    condition: selection
tags:
    - attack.execution
    - attack.reconnaissance
    - attack.discovery
    - attack.credential_access
    - attack.impact
falsepositives:
    - Penetration testing
level: high
