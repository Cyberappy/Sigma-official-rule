title: Kwampirs RAT
id: 844285a2-66e7-43ec-86d0-00295f65bcaf
status: experimental
description: Detects the Kwampirs RAT process and command execution
references:
  - FBI FLASH CP-000111-MW
tags:
  - attack.s0236
author: NVISO
date: 2020/03/26
logsource:
  category: process_creation
  product: windows
detection:
  process:
    Image|endswith:
      - "wmiaprvse.exe"
      - "wmiapsrve.exe"
      - "wmiapsvrce.exe"
      - "wmiapsrvce.exe"
      - "wmiapsrvex.exe"
      - "wmiapsvre.exe"
      - "wmiapvsre.exe"
      - "wmipsvrce.exe"
      - "wmipvsre.exe"
      - "wmipsrvce.exe"
      - "wmiprvse.exe"
      - "wmipsvre.exe"
  commands:
    Image|endswith: "cmd.exe"
    CommandLine|startswith: "/c"
    CommandLine|endswith: "2>nul"
    CommandLine|contains:
      - '"hostname"'
      - '"getmac"'
      - '"ver"'
      - '"arp -a"'
      - '"systeminfo"'
      - '"tasklist /v"'
      - '"tasklist /svc"'
      - '"netstat -nab"'
      - '"wmic nic get caption,AdapterType, Manufacturer"'
      - '"wmic timezone get  caption"'
      - '"wmic IRQ get caption, IRQNumber"'
      - '"wmic port get StartingAddress, EndingAddress"'
      - '"wmic csproduct"'
      - '"wmic computerSystem"'
      - '"wmic baseboard"'
      - '"wmic cpu"'
      - '"wmic partition"'
      - '"wmic bios"'
      - '"wmic startup"'
      - '"wmic netlogin"'
      - '"wmic portconnector"'
      - '"wmic memphysical"'
      - '"wmic share"'
      - '"wmic logon"'
      - '"wmic OS"'
      - '"wmic logicaldisk get caption,description,size, providername"'
      - '"wmic desktop"'
      - '"wmic process get caption,commandline"'
  condition: process OR commands
fields:
  - CommandLine
  - ParentCommandLine
falsepositives:
  - unlikely
level: critical
